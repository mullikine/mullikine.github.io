<!doctype html>
<html lang="en-us">
  <head>
    <title>Circumventing paywalls with eww browser and curl // Bodacious Blog</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.59.0-DEV" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://mullikine.github.io/css/main.min.e16b988f17f20e2d00cf6c3a4ab247ac7dc0a39d43725a98e46eaeb59d185840.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Circumventing paywalls with eww browser and curl"/>
<meta name="twitter:description" content="Use Google cache and curl Often Google cache has a full copy of an article.
We use curl to check the existence of the cache for a given URL as some URLs may not be cached.
This is not an accurate science. Sometimes the cache is needed and sometimes it is not, but the more information we bring in (such as if the cache exists), the better, as this leads to a more informed decision."/>

    <meta property="og:title" content="Circumventing paywalls with eww browser and curl" />
<meta property="og:description" content="Use Google cache and curl Often Google cache has a full copy of an article.
We use curl to check the existence of the cache for a given URL as some URLs may not be cached.
This is not an accurate science. Sometimes the cache is needed and sometimes it is not, but the more information we bring in (such as if the cache exists), the better, as this leads to a more informed decision." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mullikine.github.io/posts/circumventing-paywalls-with-eww-browser-and-curl/" />
<meta property="article:published_time" content="2019-09-18T00:00:00+12:00" />
<meta property="article:modified_time" content="2019-09-18T00:00:00+12:00" /><meta property="og:site_name" content="Bodacious Blog" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://mullikine.github.io"><img class="app-header-avatar" src="http://mullikine.github.io/brainy.png" alt="John Doe" /></a>
      <h1>Bodacious Blog</h1>
      <p>biosemiotics üåª, xenolingustics üëΩ and emacs üêÑ</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://linkedin.com/in/shane-mulligan-811b942b/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>linkedin</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg></a>
        
          <a target="_blank" href="https://gitlab.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-gitlab">
  <title>gitlab</title>
  <path d="M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.49h8.1l2.44-7.51A.42.42 0 0 1 18.6 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.51L23 13.45a.84.84 0 0 1-.35.94z"></path>
</svg></a>
        
          <a target="_blank" href="https://www.facebook.com/shrubgrub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-facebook">
  <title>facebook</title>
  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg></a>
        
          <a target="_blank" href="https://twitter.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
        <a href="https://mullikine.github.io/cv/">CV</a>
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Circumventing paywalls with eww browser and curl</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Sep 18, 2019
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div></div>
    </header>
    

<link rel="stylesheet" type="text/css" href="https://mullikine.github.io/css/magit.css"/>

<script src="https://mullikine.github.io/js/mathjax-config.js"></script>
 
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML"></script>


    <div class="post-content">
      

<h2 id="use-google-cache-and-curl">Use Google cache and curl</h2>

<p>Often Google cache has a full copy of an
article.</p>

<p>We use curl to check the existence of the
cache for a given URL as some URLs may not be
cached.</p>

<p>This is not an accurate science. Sometimes the
cache is needed and sometimes it is not, but
the more information we bring in (such as if
the cache exists), the better, as this leads to
a more informed decision.</p>

<h3 id="make-the-curl-firefox-script-dot-we-call-this-script-from-emacs">Make the <code>curl-firefox</code> script. We call this script from emacs</h3>

<p>Vanilla curl always returns 404 from Google&rsquo;s
cache.</p>

<p>We need to add the user agent with -A.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
/usr/bin/curl -A <span style="color:#e6db74">&#34;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0&#34;</span> <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span></code></pre></div>
<h3 id="write-the-test-functions-in-emacs-lisp">Write the test functions in emacs-lisp</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs" data-lang="emacs"><span style="color:#75715e">;; See this article for ~sh-notty~</span>
<span style="color:#75715e">;; https://mullikine.github.io/posts/macro-tutorial/</span>

(defmacro sh-notty-true (cmd <span style="color:#66d9ef">&amp;rest</span> sh-notty-args)
  <span style="color:#e6db74">&#34;Returns t if the shell command exists with 0&#34;</span>
  <span style="color:#f92672">`</span>(let ((result (sh-notty <span style="color:#f92672">,</span>cmd <span style="color:#f92672">,@</span>sh-notty-args)))
     (<span style="color:#a6e22e">string-equal</span> b_exit_code <span style="color:#e6db74">&#34;0&#34;</span>)))

(defun url-is-404 (url)
  <span style="color:#e6db74">&#34;URL is 404&#34;</span>
  (sh-notty-true (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;curl-firefox -s -I &#34;</span> (q url) <span style="color:#e6db74">&#34; | grep -q \&#34;404 Not Found\&#34;&#34;</span>)))

(defun url-cache-is-404 (url)
  <span style="color:#e6db74">&#34;URL cache is 404&#34;</span>
  (url-is-404 (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;http://webcache.googleusercontent.com/search?q=cache:&#34;</span> url)))</code></pre></div>
<h3 id="try-them-out">Try them out</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs" data-lang="emacs">(url-is-404 <span style="color:#e6db74">&#34;https://medium.com/riselab/functional-rl-with-keras-and-tensorflow-eager-7973f81d6345&#34;</span>)
(url-cache-is-404 <span style="color:#e6db74">&#34;https://medium.com/riselab/functional-rl-with-keras-and-tensorflow-eager-7973f81d6345&#34;</span>)
(url-is-404 <span style="color:#e6db74">&#34;https://www.cryptocompare.com/coins/nas/overview&#34;</span>)
(url-is-404 <span style="color:#e6db74">&#34;https://news.ycombinator.com/&#34;</span>)
(url-cache-is-404 <span style="color:#e6db74">&#34;https://news.ycombinator.com/&#34;</span>)</code></pre></div>
<h3 id="add-some-advice-to-the-eww-command-which-expands-urls-just-before-they-are-loaded">Add some advice to the eww command which expands URLs just before they are loaded</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs" data-lang="emacs"><span style="color:#75715e">;; This makes it so for certain urls, the google cache is loaded instead</span>
(defun eww--dwim-expand-url-around-advice (proc <span style="color:#66d9ef">&amp;rest</span> args)
  (let* ((url (<span style="color:#a6e22e">car</span> args))
         (cached_url (replace-regexp-in-string <span style="color:#e6db74">&#34;^&#34;</span> <span style="color:#e6db74">&#34;http://webcache.googleusercontent.com/search?q=cache:&#34;</span> url)))
    (if (and (or (string-match-p <span style="color:#e6db74">&#34;towardsdatascience&#34;</span> url)
                 (string-match-p <span style="color:#e6db74">&#34;medium.com&#34;</span> url))
             (not (string-match-p <span style="color:#e6db74">&#34;webcache.google&#34;</span> url))
             (not (url-cache-is-404 cached_url)))
        (setq url cached_url))
    (let ((res (<span style="color:#a6e22e">apply</span> proc (<span style="color:#a6e22e">list</span> url))))
      res)))
(advice-add <span style="color:#e6db74">&#39;eww--dwim-expand-url</span> :around <span style="color:#a6e22e">#&#39;</span>eww--dwim-expand-url-around-advice)</code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
