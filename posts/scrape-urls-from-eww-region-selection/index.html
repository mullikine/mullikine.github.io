<!doctype html>
<html lang="en-us">
  <head>
    <title>Scrape URLs from eww region selection // Bodacious Blog</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.59.0-DEV" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://mullikine.github.io/css/main.min.53925bc548b1a2a1afc101d7381bf9f5d6586be185674504ad3b0cc58a706873.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Scrape URLs from eww region selection"/>
<meta name="twitter:description" content="The idea is you select a region of text on the screen and the text properties will be searched for URLs.
A new buffer is created with all the list of URLs in the region you selected.
This works on any emacs mode.
Of course, for external programs such as w3m, emacs wont be able to scrape these URLs from the text properties.
(defmacro bp (&amp;rest body) &#34;Pipe string into bash command."/>

    <meta property="og:title" content="Scrape URLs from eww region selection" />
<meta property="og:description" content="The idea is you select a region of text on the screen and the text properties will be searched for URLs.
A new buffer is created with all the list of URLs in the region you selected.
This works on any emacs mode.
Of course, for external programs such as w3m, emacs wont be able to scrape these URLs from the text properties.
(defmacro bp (&amp;rest body) &#34;Pipe string into bash command." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mullikine.github.io/posts/scrape-urls-from-eww-region-selection/" />
<meta property="article:published_time" content="2019-10-03T00:00:00+13:00" />
<meta property="article:modified_time" content="2019-10-03T00:00:00+13:00" /><meta property="og:site_name" content="Bodacious Blog" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://mullikine.github.io"><img class="app-header-avatar" src="http://mullikine.github.io/brainy.png" alt="John Doe" /></a>
      <h1>Bodacious Blog</h1>
      <p>biosemiotics, xenolingustics and emacs</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://twitter.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Scrape URLs from eww region selection</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Oct 3, 2019
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div></div>
    </header>
    <div class="post-content">
      <p>The idea is you select a region of text on the screen and the text properties will be searched for URLs.</p>

<p>A new buffer is created with all the list of URLs in the region you selected.</p>

<p>This works on any emacs mode.</p>

<p>Of course, for external programs such as w3m, emacs wont be able to scrape these URLs from the text properties.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs" data-lang="emacs">(defmacro bp (<span style="color:#66d9ef">&amp;rest</span> body)
  <span style="color:#e6db74">&#34;Pipe string into bash command. Return stdout.&#34;</span>
  <span style="color:#75715e">;; Remove the last element from a list</span>
  <span style="color:#f92672">`</span>(sh-notty (<span style="color:#a6e22e">concat</span> (quote-args <span style="color:#f92672">,@</span>(butlast body))) <span style="color:#f92672">,@</span>(last body)))

(defun preserve-trailing-whitespace (fun s)
  <span style="color:#e6db74">&#34;Run a string filter command, but preserve the amount of trailing whitespace. (ptw &#39;awk1 \&#34;hi\&#34;)&#34;</span>
  (setq trailing_ws_pat <span style="color:#e6db74">&#34;[ \t\n]*\\&#39;&#34;</span>)

  (let* ((original_whitespace (regex-match-string trailing_ws_pat s))
         (result (<span style="color:#a6e22e">apply</span> fun (<span style="color:#a6e22e">list</span> s)))
         (new_result (<span style="color:#a6e22e">concat</span> (replace-regexp-in-string trailing_ws_pat <span style="color:#e6db74">&#34;&#34;</span> result) original_whitespace)))
    new_result))
(defalias <span style="color:#e6db74">&#39;ptw</span> <span style="color:#e6db74">&#39;preserve-trailing-whitespace</span>)

(defmacro defshellfilter (<span style="color:#66d9ef">&amp;rest</span> body)
  <span style="color:#e6db74">&#34;Define a new string filter function based on a shell command&#34;</span>
  (let* (<span style="color:#75715e">;; (s (str2sym (concat &#34;sh/&#34; (sym2str (first body)))))</span>
         (base (slugify (list2string body) <span style="color:#66d9ef">t</span>))
         (sm (str2sym (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;sh/m/&#34;</span> base)))
         (sf (str2sym (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;sh/&#34;</span> base)))
         (sfptw (str2sym (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;sh/ptw/&#34;</span> base))))
    <span style="color:#f92672">`</span>(progn (defmacro <span style="color:#f92672">,</span>sm
                (<span style="color:#66d9ef">&amp;rest</span> body)
              <span style="color:#f92672">`</span>(bp <span style="color:#f92672">,@</span><span style="color:#e6db74">&#39;,body</span> <span style="color:#f92672">,@</span>body))
            (defun <span style="color:#f92672">,</span>sf
                (<span style="color:#66d9ef">&amp;rest</span> body)
              (<span style="color:#a6e22e">eval</span> <span style="color:#f92672">`</span>(bp <span style="color:#f92672">,@</span><span style="color:#e6db74">&#39;,body</span> <span style="color:#f92672">,@</span>body)))
            (defun <span style="color:#f92672">,</span>sfptw
                (<span style="color:#66d9ef">&amp;rest</span> body)
              <span style="color:#75715e">;; (eval `(ptw &#39;,&#39;,sf (quote-args ,@body)))</span>
              (<span style="color:#a6e22e">eval</span> <span style="color:#f92672">`</span>(ptw <span style="color:#e6db74">&#39;,&#39;,sf</span> <span style="color:#f92672">,@</span>body))))))

(defshellfilter xurls)

(defun etv-urls-in-region ()
  (interactive)
  (if (region-active-p)
      (new-buffer-from-string (sh/ptw/uniqnosort (sh/ptw/xurls (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%S&#34;</span> (<span style="color:#a6e22e">buffer-substring</span> (<span style="color:#a6e22e">region-beginning</span>) (<span style="color:#a6e22e">region-end</span>))))))
    (new-buffer-from-string (sh/ptw/uniqnosort (sh/ptw/xurls (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%S&#34;</span> (<span style="color:#a6e22e">buffer-string</span>)))))))</code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
