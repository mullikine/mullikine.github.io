<!doctype html>
<html lang="en-us">
  <head>
    <title>Taming term-mode // Bodacious Blog</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.71.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Shane Mulligan" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://mullikine.github.io/css/main.min.c93a97e54f16df99439e5c4acf79edb18fcb9e5384f1edc008a7a4639844b254.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Taming term-mode"/>
<meta name="twitter:description" content="libertyprime to #emacs i found myself recording an asciinema recording of me making an asciinema recording of me playing tetris inside of tmux inside of neovim inside of emacs inside of an emacs term inside of 4 nested tmuxes. it became hard to actually think about  First attempt You can skip this and scroll down to the solution or read it to see some of the problems I was having with term."/>

    <meta property="og:title" content="Taming term-mode" />
<meta property="og:description" content="libertyprime to #emacs i found myself recording an asciinema recording of me making an asciinema recording of me playing tetris inside of tmux inside of neovim inside of emacs inside of an emacs term inside of 4 nested tmuxes. it became hard to actually think about  First attempt You can skip this and scroll down to the solution or read it to see some of the problems I was having with term." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mullikine.github.io/posts/taming-term/" />
<meta property="article:published_time" content="2019-10-07T00:00:00+13:00" />
<meta property="article:modified_time" content="2019-10-07T00:00:00+13:00" /><meta property="og:site_name" content="Bodacious Blog" />


  </head>
  <body>
    <header class="app-header">



<a href="https://mullikine.github.io"><img class="app-header-avatar" src="http://mullikine.github.io/fievel.png" alt="Shane Mulligan" /></a>
      <h1>Bodacious Blog</h1>
      
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://linkedin.com/in/shane-mulligan-811b942b/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>linkedin</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg></a>
        
          <a target="_blank" href="https://gitlab.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-gitlab">
  <title>gitlab</title>
  <path d="M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.49h8.1l2.44-7.51A.42.42 0 0 1 18.6 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.51L23 13.45a.84.84 0 0 1-.35.94z"></path>
</svg></a>
        
          <a target="_blank" href="https://twitter.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
        <a href="https://mullikine.github.io/cv/">CV</a>
      </div>
<div class="highlights">


<a href="https://mullikine.github.io/posts/practical-macros-in-racket-and-how-to-work-with-them/">Practical macros in Racket</a>
<br />
<a href="https://mullikine.github.io/posts/github-search-with-bigquery/">Searching GitHub with BigQuery</a>

<br />
<a href="https://mullikine.github.io/posts/arbitrary-interpreters-for-babel/">Arbitrary interpreters for Babel</a>
<br />
<a href="https://mullikine.github.io/posts/review-of-the-illustrated-transformer/">The Illustrated Transformer</a>
<br />
<a href="https://mullikine.github.io/glossary.html">Glossary A-Z (70 topics)</a>
<br />
<a href="https://mullikine.github.io/codelingo-vs-linters/summary/">CodeLingo vs Linters</a>
<br />
<div class="taglist">

<a class="tag" href="https://mullikine.github.io/tags/biosemiotics/">biosemiotics</a>
<a class="tag" href="https://mullikine.github.io/tags/xenolinguistics/">xenolinguistics</a>
<a class="tag big" href="https://mullikine.github.io/tags/emacs/">emacs</a>
<a class="tag" href="https://mullikine.github.io/tags/gpt-2/">GPT-2</a>
<a class="tag" href="https://mullikine.github.io/tags/elisp/">elisp</a>
<a class="tag" href="https://mullikine.github.io/tags/racket/">racket</a>
<a class="tag" href="https://mullikine.github.io/tags/haskell/">haskell</a>
<a class="tag" href="https://mullikine.github.io/tags/nlp/">NLP</a>
<a class="tag" href="https://mullikine.github.io/tags/docker/">docker</a>
<a class="tag" href="https://mullikine.github.io/tags/feature-engineering/">feature-engineering</a>
<a class="tag big" href="https://mullikine.github.io/tags/ir/">IR</a>
<a class="tag" href="https://mullikine.github.io/tags/games/">games</a>
<a class="tag" href="https://mullikine.github.io/tags/data/">data</a>
<a class="tag" href="https://mullikine.github.io/tags/info/">info theory</a>
<a class="tag" href="https://mullikine.github.io/tags/probability/">probability</a>
<a class="tag" href="https://mullikine.github.io/tags/problog/">problog</a>
<a class="tag big" href="https://mullikine.github.io/tags/bash/">bash</a>
<a class="tag" href="https://mullikine.github.io/tags/gcp/">GCP</a>
<a class="tag big" href="https://mullikine.github.io/tags/github/">GitHub</a>
<a class="tag" href="https://mullikine.github.io/tags/parsers/">parsers</a>
<a class="tag" href="https://mullikine.github.io/tags/rust/">rust</a>
<a class="tag" href="https://mullikine.github.io/tags/cpp/">c++</a>
<a class="tag" href="https://mullikine.github.io/tags/review/">review</a>
<a class="tag" href="https://mullikine.github.io/tags/kaggle/">kaggle</a>
<a class="tag" href="https://mullikine.github.io/tags/dl/">deep learning</a>
<a class="tag" href="https://mullikine.github.io/tags/dsls/">DSLs</a>
<a class="tag" href="https://mullikine.github.io/tags/df/">dwarf fortress</a>
<a class="tag" href="https://mullikine.github.io/tags/spacy/">spacy</a>
<a class="tag" href="https://mullikine.github.io/tags/latex/">latex</a>
<a class="tag" href="https://mullikine.github.io/tags/nix/">Nix</a>
<a class="tag" href="https://mullikine.github.io/tags/graphviz/">graphviz</a>
<a class="tag" href="https://mullikine.github.io/tags/python/">python</a>
<a class="tag" href="https://mullikine.github.io/tags/golang/">golang</a>
<a class="tag" href="https://mullikine.github.io/tags/codelingo/">codelingo</a>
<a class="tag" href="https://mullikine.github.io/tags/perl/">perl</a>
<a class="tag" href="https://mullikine.github.io/tags/math/">math</a>
<a class="tag big" href="https://mullikine.github.io/tags/vim/">vim</a>
<a class="tag" href="https://mullikine.github.io/tags/telco/">telco</a>
<a class="tag" href="https://mullikine.github.io/tags/automation/">automation</a>
<a class="tag" href="https://mullikine.github.io/tags/terminals/">terminals</a>
<a class="tag" href="https://mullikine.github.io/tags/transformer/">transformer</a>
<a class="tag big" href="https://mullikine.github.io/tags/codegen/">code-gen</a>
<a class="tag" href="https://mullikine.github.io/tags/optimisation/">optimisation</a>
<a class="tag" href="https://mullikine.github.io/tags/release/">release</a>
<a class="tag" href="https://mullikine.github.io/tags/dotnet/">.NET</a>
<a class="tag" href="https://mullikine.github.io/tags/csharp/">csharp</a>
<a class="tag" href="https://mullikine.github.io/tags/tooling/">tooling</a>
<a class="tag" href="https://mullikine.github.io/tags/iac/">IaC</a>
<a class="tag big" href="https://mullikine.github.io/tags/facebook/">Facebook</a>
<a class="tag" href="https://mullikine.github.io/tags/wfh/">WFH</a>
</div>
</div>
<div class="highlights">
<a href="https://mullikine.github.io/posts/rat/">Automating rat</a>
<br />
<a href="https://mullikine.github.io/posts/dwarf-fortress-macros-with-emacs-and-tmux/">Automating Dwarf Fortress</a>
<br />
</div>
<div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Taming term-mode</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Oct 7, 2019
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          12 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://mullikine.github.io/tags/emacs/">emacs</a><a class="tag" href="http://mullikine.github.io/tags/elisp/">elisp</a><a class="tag" href="http://mullikine.github.io/tags/terminals/">terminals</a><a class="tag" href="http://mullikine.github.io/tags/tooling/">tooling</a></div></div>
    </header>
    

<link rel="stylesheet" type="text/css" href="https://mullikine.github.io/css/magit.css"/>

<script src="https://mullikine.github.io/js/mathjax-config.js"></script>
 
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML"></script>


    <div class="post-content">
      <dl>
<dt>libertyprime to #emacs</dt>
<dd>i found myself recording an asciinema recording of me making an asciinema
recording of me playing tetris inside of tmux inside of neovim inside of emacs
inside of an emacs term inside of 4 nested tmuxes. it became hard to actually think about</dd>
</dl>
<h2 id="first-attempt">First attempt</h2>
<p>You can skip this and scroll down to the
solution or read it to see some of the
problems I was having with <code>term.el</code>.</p>
<h3 id="problems-with-term-dot-el">Problems with <code>term.el</code></h3>
<h4 id="any-minor-mode-which-is-enabled-while-term-is-running-will-override-bindings">Any minor mode which is enabled while term is running will override bindings</h4>
<p>Therefore, if you can, make any such bindings
that may interfere with term into global
mappings instead.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="color:#75715e">;; Comment this out</span>
<span style="color:#75715e">;; (define-key my-mode-map (kbd &#34;M-k&#34;) &#39;avy-goto-char)</span>

<span style="color:#75715e">;; Unload binding</span>
(<span style="color:#a6e22e">define-key</span> my-mode-map (kbd <span style="color:#e6db74">&#34;M-k&#34;</span>) <span style="color:#66d9ef">nil</span>)

<span style="color:#75715e">;; Replace with this</span>
(<span style="color:#a6e22e">define-key</span> global-map (kbd <span style="color:#e6db74">&#34;M-k&#34;</span>) <span style="color:#e6db74">&#39;avy-goto-char</span>)</code></pre></td></tr></table>
</div>
</div>
<h4 id="gud-mode-stole-c-c-c-a"><code>gud-mode</code> stole <code>C-c C-a</code></h4>
<p><code>C-a</code> is important in many programs for going to the start of the line.</p>
<p><code>gud-mode</code> creates a global prefix before we have time to prevent that from happening</p>
<ul>
<li>Load this early before <code>gud</code> is required</li>
</ul>
<pre><code>That way it will set its global binding to this prefix instead.

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">    <span style="color:#75715e">;; This prefix must never be accessible</span>
    (<span style="color:#a6e22e">define-prefix-command</span> <span style="color:#e6db74">&#39;my-prefix-tick</span>)
    <span style="color:#75715e">;; This is not a real key. Therefore it won&#39;t be pressed.</span>
    (global-set-key (kbd <span style="color:#e6db74">&#34;✓&#34;</span>) <span style="color:#e6db74">&#39;my-prefix-tick</span>)

    (setq gud-key-prefix (kbd <span style="color:#e6db74">&#34;✓&#34;</span>))

    (provide <span style="color:#e6db74">&#39;my-gud</span>)
    </code></pre></td></tr></table>
</div>
</div>
</code></pre>
<h4 id="if-you-can-disable-modes-that-interfere-with-term-using-manage-minor-mode">If you can, disable modes that interfere with term using <code>manage-minor-mode</code></h4>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(term-mode
 (off my-mode))</code></pre></td></tr></table>
</div>
</div>
<h4 id="give-c-a-to-term">Give <code>C-a</code> to term</h4>
<p>This is needed so we can use <code>C-a</code> in whatever
application needs it. Bash recognises <code>C-a</code> as
the command to go to the start of the line,
for instance.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-a&#34;</span>) <span style="color:#a6e22e">#&#39;</span>term-send-raw)

<span style="color:#75715e">;; We also need C-x. term-send-raw sends the last char typed, so this should send C-x</span>
(<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c C-x&#34;</span>) <span style="color:#a6e22e">#&#39;</span>term-send-raw)</code></pre></td></tr></table>
</div>
</div>
<h3 id="obstacles-to-fixing-term-dot-el">Obstacles to fixing <code>term.el</code></h3>
<h4 id="it-does-not-play-well-with-manage-minor-mode-dot-el">It does not play well with <code>manage-minor-mode.el</code></h4>
<p>Also, <code>manage-minor-mode</code> is not all-powerful:
you can&rsquo;t enable a minor mode globally but
disable it for a single major mode, for
instance.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="color:#75715e">;; This does not work sadly</span>
(term-mode
 (off yas-minor-mode)
 (off org-indent-mode)
 (off persp-mode)
 (off which-key-mode)
 (off company-mode)
 (off gud-minor-mode))</code></pre></td></tr></table>
</div>
</div>
<h3 id="ensure-line-numbers-mode-linum-mode-etc-dot-are-disabled">Ensure <code>line-numbers-mode</code>, <code>linum-mode</code> etc. are disabled</h3>
<p>It messes up the term.</p>
<p>My <code>line-numbers-mode</code> was globalised.</p>
<p>Therefore, disabling it with <code>manage-minor-mode</code> wasn&rsquo;t an option for me.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(setq manage-minor-mode-default
      <span style="color:#f92672">&#39;</span>((term-mode
         (off linum-mode))))</code></pre></td></tr></table>
</div>
</div>
<p>I tried using hooks but, due to the way term
is started, the modes were not disabled until
after term had exit.</p>
<p><code>term-load-hook</code> did nothing at all.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(add-hook <span style="color:#e6db74">&#39;term-mode-hook</span> <span style="color:#a6e22e">#&#39;</span>disable-modes-for-term)
(add-hook <span style="color:#e6db74">&#39;term-load-hook</span> <span style="color:#a6e22e">#&#39;</span>disable-modes-for-term)</code></pre></td></tr></table>
</div>
</div>
<p>Therefore, I used advice to turn off my
globalised modes. That worked for me.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(defun disable-modes-for-term ()
  (interactive)
  (progn
    (global-display-line-numbers-mode <span style="color:#ae81ff">-1</span>)
    (global-hide-mode-line-mode <span style="color:#ae81ff">1</span>)
    (visual-line-mode <span style="color:#ae81ff">-1</span>)
    (fringe-mode <span style="color:#ae81ff">-1</span>))

  (my-mode <span style="color:#ae81ff">-1</span>))

(defun term-around-advice (proc <span style="color:#66d9ef">&amp;rest</span> args)
  (let ((res (<span style="color:#a6e22e">apply</span> proc args)))
    (disable-modes-for-term)
    res))
(advice-add <span style="color:#e6db74">&#39;term</span> :around <span style="color:#a6e22e">#&#39;</span>term-around-advice)</code></pre></td></tr></table>
</div>
</div>
<h3 id="the-term-raw-mode-escape-char-is-a-problem-dot-reassign-it-to-a-key-that-doesn-t-exist">The <code>term-raw-mode</code> escape char is a problem. Reassign it to a key that doesn&rsquo;t exist</h3>
<p>Unfortunately, the <code>C-c</code> prefix is populated with all manor of things.</p>
<p>There is no way to avoid it.</p>
<p>Reassign this key.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(term-set-escape-char <span style="color:#e6db74">?✓</span>)</code></pre></td></tr></table>
</div>
</div>
<h2 id="the-solution-it-requires-a-fair-bit-of-emacs-lisp">The solution: It requires a fair bit of emacs lisp</h2>
<p>I can&rsquo;t abolish C-c from all the minor modes,
but at least I can control what happens when I
press it!</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(setq explicit-shell-file-name <span style="color:#e6db74">&#34;/bin/bash&#34;</span>)

<span style="color:#75715e">;; These prefixes are required for my-term-set-raw-map</span>
(<span style="color:#a6e22e">define-prefix-command</span> <span style="color:#e6db74">&#39;my-term-c-c</span>)
(<span style="color:#a6e22e">define-prefix-command</span> <span style="color:#e6db74">&#39;my-term-c-c-esc</span>)

<span style="color:#75715e">;; When the program ends, use C-d to kill the buffer</span>
(defun term-raw-or-kill ()
  (interactive)
  (if (not (term-check-proc (<span style="color:#a6e22e">current-buffer</span>)))
      (<span style="color:#a6e22e">kill-buffer</span>)
    (term-send-raw)))

(defun my-term-set-raw-map ()
  (interactive)
        (let* ((map (<span style="color:#a6e22e">make-keymap</span>))
               (esc-map (<span style="color:#a6e22e">make-keymap</span>))
               (i <span style="color:#ae81ff">0</span>))

          (<span style="color:#a6e22e">define-key</span> map (kbd <span style="color:#e6db74">&#34;C-c&#34;</span>) <span style="color:#a6e22e">#&#39;</span>my-term-c-c)
          (<span style="color:#a6e22e">define-key</span> map (kbd <span style="color:#e6db74">&#34;C-c ESC&#34;</span>) <span style="color:#a6e22e">#&#39;</span>my-term-c-c-esc)

          (while (<span style="color:#a6e22e">&lt;</span> i <span style="color:#ae81ff">128</span>)
            <span style="color:#75715e">;; if not C-c</span>
            (if (not (equalp i <span style="color:#ae81ff">3</span>))
                (<span style="color:#a6e22e">define-key</span> map (<span style="color:#a6e22e">make-string</span> <span style="color:#ae81ff">1</span> i) <span style="color:#a6e22e">#&#39;</span>term-send-raw))

            (<span style="color:#a6e22e">define-key</span> map (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;\C-c&#34;</span> (<span style="color:#a6e22e">make-string</span> <span style="color:#ae81ff">1</span> i)) <span style="color:#e6db74">&#39;term-send-raw</span>)
            <span style="color:#75715e">;; Avoid O and [. They are used in escape sequences for various keys.</span>
            (unless (or (<span style="color:#a6e22e">eq</span> i <span style="color:#e6db74">?O</span>) (<span style="color:#a6e22e">eq</span> i <span style="color:#ae81ff">91</span>))
              (<span style="color:#a6e22e">define-key</span> esc-map (<span style="color:#a6e22e">make-string</span> <span style="color:#ae81ff">1</span> i) <span style="color:#e6db74">&#39;term-send-raw-meta</span>))
            (setq i (<span style="color:#a6e22e">1+</span> i)))
          (<span style="color:#a6e22e">define-key</span> map [remap <span style="color:#a6e22e">self-insert-command</span>] <span style="color:#e6db74">&#39;term-send-raw</span>)
          (<span style="color:#a6e22e">define-key</span> map <span style="color:#e6db74">&#34;\e&#34;</span> esc-map)

          <span style="color:#75715e">;; Added nearly all the &#39;gray keys&#39; -mm</span>

          (if (featurep <span style="color:#e6db74">&#39;xemacs</span>)
              (<span style="color:#a6e22e">define-key</span> map [button2] <span style="color:#e6db74">&#39;term-mouse-paste</span>)
            (<span style="color:#a6e22e">define-key</span> map [mouse-2] <span style="color:#e6db74">&#39;term-mouse-paste</span>))
          (<span style="color:#a6e22e">define-key</span> map (kbd <span style="color:#e6db74">&#34;C-p&#34;</span>) <span style="color:#e6db74">&#39;term-send-raw</span>)
          (<span style="color:#a6e22e">define-key</span> map [up] <span style="color:#e6db74">&#39;term-send-up</span>)
          (<span style="color:#a6e22e">define-key</span> map [down] <span style="color:#e6db74">&#39;term-send-down</span>)
          (<span style="color:#a6e22e">define-key</span> map [right] <span style="color:#e6db74">&#39;term-send-right</span>)
          (<span style="color:#a6e22e">define-key</span> map [left] <span style="color:#e6db74">&#39;term-send-left</span>)
          (<span style="color:#a6e22e">define-key</span> map [C-up] <span style="color:#e6db74">&#39;term-send-ctrl-up</span>)
          (<span style="color:#a6e22e">define-key</span> map [C-down] <span style="color:#e6db74">&#39;term-send-ctrl-down</span>)
          (<span style="color:#a6e22e">define-key</span> map [C-right] <span style="color:#e6db74">&#39;term-send-ctrl-right</span>)
          (<span style="color:#a6e22e">define-key</span> map [C-left] <span style="color:#e6db74">&#39;term-send-ctrl-left</span>)
          (<span style="color:#a6e22e">define-key</span> map [<span style="color:#a6e22e">delete</span>] <span style="color:#e6db74">&#39;term-send-del</span>)
          (<span style="color:#a6e22e">define-key</span> map [deletechar] <span style="color:#e6db74">&#39;term-send-del</span>)
          (<span style="color:#a6e22e">define-key</span> map [backspace] <span style="color:#e6db74">&#39;term-send-backspace</span>)
          (<span style="color:#a6e22e">define-key</span> map [home] <span style="color:#e6db74">&#39;term-send-home</span>)
          (<span style="color:#a6e22e">define-key</span> map [end] <span style="color:#e6db74">&#39;term-send-end</span>)
          (<span style="color:#a6e22e">define-key</span> map [<span style="color:#a6e22e">insert</span>] <span style="color:#e6db74">&#39;term-send-insert</span>)
          (<span style="color:#a6e22e">define-key</span> map [S-prior] <span style="color:#e6db74">&#39;scroll-down</span>)
          (<span style="color:#a6e22e">define-key</span> map [S-next] <span style="color:#e6db74">&#39;scroll-up</span>)
          (<span style="color:#a6e22e">define-key</span> map [S-insert] <span style="color:#e6db74">&#39;term-paste</span>)
          (<span style="color:#a6e22e">define-key</span> map [prior] <span style="color:#e6db74">&#39;term-send-prior</span>)
          (<span style="color:#a6e22e">define-key</span> map [next] <span style="color:#e6db74">&#39;term-send-next</span>)
          (<span style="color:#a6e22e">define-key</span> map [xterm-paste] <span style="color:#a6e22e">#&#39;</span>term--xterm-paste)
          (<span style="color:#a6e22e">define-key</span> map (kbd <span style="color:#e6db74">&#34;C-d&#34;</span>) <span style="color:#e6db74">&#39;term-raw-or-kill</span>)
          (setq term-raw-map map)
          (setq term-raw-escape-map esc-map))
  <span style="color:#75715e">;; This means that M-l will not pass though. I have it set to a hydra menu</span>
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;M-l&#34;</span>) <span style="color:#66d9ef">nil</span>)
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c ESC&#34;</span>) <span style="color:#a6e22e">#&#39;</span>my-term-c-c-esc)
  <span style="color:#75715e">;; To send M-l, you do C-c M-l</span>
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c M-l&#34;</span>) <span style="color:#a6e22e">#&#39;</span>term-send-raw-meta)
  <span style="color:#75715e">;; To bring up the eval repl, press C-c M-:</span>
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c M-:&#34;</span>) <span style="color:#a6e22e">#&#39;</span>pp-eval-expression)
  <span style="color:#75715e">;; (define-key term-raw-map (kbd &#34;C-s&#34;) #&#39;term-line-mode)</span>
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c C-j&#34;</span>) <span style="color:#a6e22e">#&#39;</span>term-line-mode)
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c C-h&#34;</span>) <span style="color:#a6e22e">#&#39;</span>describe-mode)
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-d&#34;</span>) <span style="color:#e6db74">&#39;term-raw-or-kill</span>))

<span style="color:#75715e">;; This is required because something keeps resetting the map.</span>
<span style="color:#75715e">;; I think (require &#39;term), for one, will redefine the value of the map</span>
(defun term-around-advice (proc <span style="color:#66d9ef">&amp;rest</span> args)
  (my-term-set-raw-map)
  (let ((res (<span style="color:#a6e22e">apply</span> proc args)))
    res))
(advice-add <span style="color:#e6db74">&#39;term</span> :around <span style="color:#a6e22e">#&#39;</span>term-around-advice)

<span style="color:#75715e">;; Not sure why this is not sufficient</span>
(my-term-set-raw-map)

<span style="color:#75715e">;; We make the term escape char something we can never hit. Not unless you have a tick key on your keyboard, that is</span>
(term-set-escape-char <span style="color:#e6db74">?✓</span>)

<span style="color:#75715e">;; We don&#39;t want to move the terminal around as we are trying to use it</span>
(defun my-term-set-scroll-margin ()
  (<span style="color:#a6e22e">make-local-variable</span> <span style="color:#e6db74">&#39;hscroll-margin</span>)
  (setq hscroll-margin <span style="color:#ae81ff">0</span>)
  (<span style="color:#a6e22e">make-local-variable</span> <span style="color:#e6db74">&#39;scroll-margin</span>)
  (setq scroll-margin <span style="color:#ae81ff">0</span>)
  (<span style="color:#a6e22e">make-local-variable</span> <span style="color:#e6db74">&#39;scroll-conservatively</span>)
  (setq scroll-conservatively <span style="color:#ae81ff">10000</span>))

(add-hook <span style="color:#e6db74">&#39;term-mode-hook</span> <span style="color:#a6e22e">#&#39;</span>my-term-set-scroll-margin)

<span style="color:#75715e">;; Redefining this is required to prevent C-s from stopping programs in the terminal</span>
(defun term-exec-1 (name buffer command switches)
  <span style="color:#75715e">;; We need to do an extra (fork-less) exec to run stty.</span>
  <span style="color:#75715e">;; (This would not be needed if we had suitable Emacs primitives.)</span>
  <span style="color:#75715e">;; The &#39;if ...; then shift; fi&#39; hack is because Bourne shell</span>
  <span style="color:#75715e">;; loses one arg when called with -c, and newer shells (bash,  ksh) don&#39;t.</span>
  <span style="color:#75715e">;; Thus we add an extra dummy argument &#34;..&#34;, and then remove it.</span>
  (let ((process-environment
       (<span style="color:#a6e22e">nconc</span>
        (<span style="color:#a6e22e">list</span>
         (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;TERM=%s&#34;</span> term-term-name)
         (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;TERMINFO=%s&#34;</span> data-directory)
         (<span style="color:#a6e22e">format</span> term-termcap-format <span style="color:#e6db74">&#34;TERMCAP=&#34;</span>
                 term-term-name term-height term-width)

         (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;INSIDE_EMACS=%s,term:%s&#34;</span> emacs-version term-protocol-version)
         (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;LINES=%d&#34;</span> term-height)
         (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;COLUMNS=%d&#34;</span> term-width))
        process-environment))
      (process-connection-type <span style="color:#66d9ef">t</span>)
      <span style="color:#75715e">;; We should suppress conversion of end-of-line format.</span>
      (inhibit-eol-conversion <span style="color:#66d9ef">t</span>)
      <span style="color:#75715e">;; The process&#39;s output contains not just chars but also binary</span>
      <span style="color:#75715e">;; escape codes, so we need to see the raw output.  We will have to</span>
      <span style="color:#75715e">;; do the decoding by hand on the parts that are made of chars.</span>
      (coding-system-for-read <span style="color:#e6db74">&#39;binary</span>))
    (when (term--bash-needs-EMACSp)
      (push (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;EMACS=%s (term:%s)&#34;</span> emacs-version term-protocol-version)
            process-environment))
    (<span style="color:#a6e22e">apply</span> <span style="color:#e6db74">&#39;start-process</span> name buffer
         <span style="color:#e6db74">&#34;/bin/sh&#34;</span> <span style="color:#e6db74">&#34;-c&#34;</span>
         (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;stty stop undef; stty start undef; stty -nl echo rows %d columns %d sane 2&gt;/dev/null;\
</span><span style="color:#e6db74">if [ $1 = .. ]; then shift; fi; exec \&#34;$@\&#34;&#34;</span>
                 term-height term-width)
         <span style="color:#e6db74">&#34;..&#34;</span>
         command switches)))

(provide <span style="color:#e6db74">&#39;my-term</span>)</code></pre></td></tr></table>
</div>
</div>
<h2 id="another-issue-is-that-you-can-t-have-multiple-terms-unless-you-rename-the-buffer">Another issue is that you can&rsquo;t have multiple terms unless you rename the buffer</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(advice-add <span style="color:#e6db74">&#39;term</span> :after <span style="color:#e6db74">&#39;unique-buffer-generic-after-advice</span>)</code></pre></td></tr></table>
</div>
</div>
<p>See one of my other blog posts to see how this is done.</p>
<p><a href="https://mullikine.github.io/posts/uniqifying-emacs-apps/">Uniqifying emacs apps // Bodacious Blog</a></p>
<h2 id="one-last-issue-is-that-sometimes-it-s-necessary-to-resize-the-program-within-term">One last issue is that sometimes it&rsquo;s necessary to resize the program within term</h2>
<p><code>term-mode</code> appears to only downsize the program but never upsize.</p>
<p>I will try to figure that out and return to this blog post.</p>
<h2 id="demonstration">Demonstration</h2>
<p><a title="asciinema recording" href="https://asciinema.org/a/8oYDfnB7xJgkQd2fkuag4548W" target="_blank"><img alt="asciinema recording" src="https://asciinema.org/a/8oYDfnB7xJgkQd2fkuag4548W.svg" /></a></p>
<h2 id="enable-256-colors">enable 256 colors</h2>
<p><a href="https://github.com/dieggsy/eterm-256color">https://github.com/dieggsy/eterm-256color</a></p>
<h2 id="enable-function-keys">enable function keys</h2>
<h3 id="use-my-function-key-branch-of-eterm-256color">Use my function key branch of <code>eterm-256color</code></h3>
<p>Neither the terminfo file <code>eterm-color.ti</code> nor
<code>eterm-256color.ti</code> had definitions for the
function keys.</p>
<p><a href="https://github.com/mullikine/eterm-256color/tree/add-function-keys">https://github.com/mullikine/eterm-256color/tree/add-function-keys</a></p>
<h3 id="add-the-following-loop-to-term-send-function-key">Add the following loop to <code>term-send-function-key</code></h3>
<p>This creates <code>C-c &lt;f1&gt;</code> to <code>C-c &lt;f4&gt;</code> for
sending those function keys through.</p>
<p>You can extend this to include more keys if you wish.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="color:#75715e">;; Send the function key to terminal</span>
(dolist (spec term-function-key-alist)
  (<span style="color:#a6e22e">define-key</span> map
    (read-kbd-macro (<span style="color:#a6e22e">message</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;C-c &lt;%s&gt;&#34;</span> (<span style="color:#a6e22e">car</span> spec))))
    <span style="color:#e6db74">&#39;term-send-function-key</span>))</code></pre></td></tr></table>
</div>
</div>
<h3 id="finish-writing-the-code-dot-just-use-the-following">Finish writing the code. Just use the following</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(defun term-send-function-key ()
  (interactive)
  (let* ((char last-input-event)
         (output (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> (str char) term-function-key-alist))))
    (term-send-raw-string output)))

(defconst term-function-key-alist <span style="color:#f92672">`</span>((<span style="color:#e6db74">&#34;f1&#34;</span> <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(read-kbd-macro <span style="color:#e6db74">&#34;&lt;ESC&gt; OP&#34;</span>))
                                    (<span style="color:#e6db74">&#34;80&#34;</span> <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(read-kbd-macro <span style="color:#e6db74">&#34;&lt;ESC&gt; OP&#34;</span>))
                                    (<span style="color:#e6db74">&#34;f2&#34;</span> <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(read-kbd-macro <span style="color:#e6db74">&#34;&lt;ESC&gt; OQ&#34;</span>))
                                    (<span style="color:#e6db74">&#34;81&#34;</span> <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(read-kbd-macro <span style="color:#e6db74">&#34;&lt;ESC&gt; OQ&#34;</span>))
                                    (<span style="color:#e6db74">&#34;f3&#34;</span> <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(read-kbd-macro <span style="color:#e6db74">&#34;&lt;ESC&gt; OR&#34;</span>))
                                    (<span style="color:#e6db74">&#34;82&#34;</span> <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(read-kbd-macro <span style="color:#e6db74">&#34;&lt;ESC&gt; OR&#34;</span>))
                                    (<span style="color:#e6db74">&#34;f4&#34;</span> <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(read-kbd-macro <span style="color:#e6db74">&#34;&lt;ESC&gt; OS&#34;</span>))
                                    (<span style="color:#e6db74">&#34;83&#34;</span> <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(read-kbd-macro <span style="color:#e6db74">&#34;&lt;ESC&gt; OS&#34;</span>))
                                    <span style="color:#75715e">;;(&#34;f2&#34; . &#34;\eOQ&#34;)</span>
                                    <span style="color:#75715e">;;(&#34;f3&#34; . &#34;\eOR&#34;)</span>
                                    <span style="color:#75715e">;;(&#34;f4&#34; . &#34;\eOS&#34;)</span>
                                    ))

(defun my-term-set-raw-map ()
  (interactive)
  (let* ((map (<span style="color:#a6e22e">make-keymap</span>))
         (esc-map (<span style="color:#a6e22e">make-keymap</span>))
         (i <span style="color:#ae81ff">0</span>))

    (<span style="color:#a6e22e">define-key</span> map (kbd <span style="color:#e6db74">&#34;C-c&#34;</span>) <span style="color:#a6e22e">#&#39;</span>my-term-c-c)
    (<span style="color:#a6e22e">define-key</span> map (kbd <span style="color:#e6db74">&#34;C-c ESC&#34;</span>) <span style="color:#a6e22e">#&#39;</span>my-term-c-c-esc)

    <span style="color:#75715e">;; Send the function key to terminal</span>
    (dolist (spec term-function-key-alist)
      (<span style="color:#a6e22e">define-key</span> map
        (read-kbd-macro (<span style="color:#a6e22e">message</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;C-c &lt;%s&gt;&#34;</span> (<span style="color:#a6e22e">car</span> spec))))
        <span style="color:#e6db74">&#39;term-send-function-key</span>))

    (while (<span style="color:#a6e22e">&lt;</span> i <span style="color:#ae81ff">128</span>)
      <span style="color:#75715e">;; if not C-c</span>
      (if (not (equalp i <span style="color:#ae81ff">3</span>))
          (<span style="color:#a6e22e">define-key</span> map (<span style="color:#a6e22e">make-string</span> <span style="color:#ae81ff">1</span> i) <span style="color:#a6e22e">#&#39;</span>term-send-raw))

      (<span style="color:#a6e22e">define-key</span> map (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;\C-c&#34;</span> (<span style="color:#a6e22e">make-string</span> <span style="color:#ae81ff">1</span> i)) <span style="color:#e6db74">&#39;term-send-raw</span>)
      <span style="color:#75715e">;; Avoid O and [. They are used in escape sequences for various keys.</span>
      (unless (or (<span style="color:#a6e22e">eq</span> i <span style="color:#e6db74">?O</span>) (<span style="color:#a6e22e">eq</span> i <span style="color:#ae81ff">91</span>))
        (<span style="color:#a6e22e">define-key</span> esc-map (<span style="color:#a6e22e">make-string</span> <span style="color:#ae81ff">1</span> i) <span style="color:#e6db74">&#39;term-send-raw-meta</span>))
      (setq i (<span style="color:#a6e22e">1+</span> i)))
    (<span style="color:#a6e22e">define-key</span> map [remap <span style="color:#a6e22e">self-insert-command</span>] <span style="color:#e6db74">&#39;term-send-raw</span>)
    (<span style="color:#a6e22e">define-key</span> map <span style="color:#e6db74">&#34;\e&#34;</span> esc-map)

    <span style="color:#75715e">;; Added nearly all the &#39;gray keys&#39; -mm</span>

    (if (featurep <span style="color:#e6db74">&#39;xemacs</span>)
        (<span style="color:#a6e22e">define-key</span> map [button2] <span style="color:#e6db74">&#39;term-mouse-paste</span>)
      (<span style="color:#a6e22e">define-key</span> map [mouse-2] <span style="color:#e6db74">&#39;term-mouse-paste</span>))
    (<span style="color:#a6e22e">define-key</span> map (kbd <span style="color:#e6db74">&#34;C-p&#34;</span>) <span style="color:#e6db74">&#39;term-send-raw</span>)
    (<span style="color:#a6e22e">define-key</span> map [up] <span style="color:#e6db74">&#39;term-send-up</span>)
    (<span style="color:#a6e22e">define-key</span> map [down] <span style="color:#e6db74">&#39;term-send-down</span>)
    (<span style="color:#a6e22e">define-key</span> map [right] <span style="color:#e6db74">&#39;term-send-right</span>)
    (<span style="color:#a6e22e">define-key</span> map [left] <span style="color:#e6db74">&#39;term-send-left</span>)
    (<span style="color:#a6e22e">define-key</span> map [C-up] <span style="color:#e6db74">&#39;term-send-ctrl-up</span>)
    (<span style="color:#a6e22e">define-key</span> map [C-down] <span style="color:#e6db74">&#39;term-send-ctrl-down</span>)
    (<span style="color:#a6e22e">define-key</span> map [C-right] <span style="color:#e6db74">&#39;term-send-ctrl-right</span>)
    (<span style="color:#a6e22e">define-key</span> map [C-left] <span style="color:#e6db74">&#39;term-send-ctrl-left</span>)
    (<span style="color:#a6e22e">define-key</span> map [<span style="color:#a6e22e">delete</span>] <span style="color:#e6db74">&#39;term-send-del</span>)
    (<span style="color:#a6e22e">define-key</span> map [deletechar] <span style="color:#e6db74">&#39;term-send-del</span>)
    (<span style="color:#a6e22e">define-key</span> map [backspace] <span style="color:#e6db74">&#39;term-send-backspace</span>)
    (<span style="color:#a6e22e">define-key</span> map [home] <span style="color:#e6db74">&#39;term-send-home</span>)
    (<span style="color:#a6e22e">define-key</span> map [end] <span style="color:#e6db74">&#39;term-send-end</span>)
    (<span style="color:#a6e22e">define-key</span> map [<span style="color:#a6e22e">insert</span>] <span style="color:#e6db74">&#39;term-send-insert</span>)
    (<span style="color:#a6e22e">define-key</span> map [S-prior] <span style="color:#e6db74">&#39;scroll-down</span>)
    (<span style="color:#a6e22e">define-key</span> map [S-next] <span style="color:#e6db74">&#39;scroll-up</span>)
    (<span style="color:#a6e22e">define-key</span> map [S-insert] <span style="color:#e6db74">&#39;term-paste</span>)
    (<span style="color:#a6e22e">define-key</span> map [prior] <span style="color:#e6db74">&#39;term-send-prior</span>)
    (<span style="color:#a6e22e">define-key</span> map [next] <span style="color:#e6db74">&#39;term-send-next</span>)
    (<span style="color:#a6e22e">define-key</span> map [xterm-paste] <span style="color:#a6e22e">#&#39;</span>term--xterm-paste)
    (<span style="color:#a6e22e">define-key</span> map (kbd <span style="color:#e6db74">&#34;C-d&#34;</span>) <span style="color:#e6db74">&#39;term-raw-or-kill</span>)
    (setq term-raw-map map)
    (setq term-raw-escape-map esc-map))
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;M-l&#34;</span>) <span style="color:#66d9ef">nil</span>)
  <span style="color:#75715e">;; I want M-x to transmit through</span>
  <span style="color:#75715e">;; (define-key term-raw-map (kbd &#34;M-x&#34;) nil)</span>
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c ESC&#34;</span>) <span style="color:#a6e22e">#&#39;</span>my-term-c-c-esc)
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c M-l&#34;</span>) <span style="color:#a6e22e">#&#39;</span>term-send-raw-meta)
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c M-:&#34;</span>) <span style="color:#a6e22e">#&#39;</span>pp-eval-expression)
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c M-x&#34;</span>) <span style="color:#a6e22e">#&#39;</span>helm-M-x)
  <span style="color:#75715e">;; (define-key term-raw-map (kbd &#34;C-s&#34;) #&#39;term-line-mode)</span>
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c C-j&#34;</span>) <span style="color:#a6e22e">#&#39;</span>term-line-mode)
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-c C-h&#34;</span>) <span style="color:#a6e22e">#&#39;</span>describe-mode)
  (<span style="color:#a6e22e">define-key</span> term-raw-map (kbd <span style="color:#e6db74">&#34;C-d&#34;</span>) <span style="color:#e6db74">&#39;term-raw-or-kill</span>))</code></pre></td></tr></table>
</div>
</div>
<h2 id="adding-a-sentinel-to-tell-me-when-the-process-closes">Adding a sentinel to tell me when the process closes</h2>
<p>This means I can create shell scripts which start processes inside emacs and close the emacs frame when done.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="color:#75715e">;; This remembers the last frame which was created</span>
(defvar termframe <span style="color:#66d9ef">nil</span>)

(defun set-termframe (frame)
  (<span style="color:#a6e22e">message</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;setting &#34;</span> (str frame)))
  (with-current-buffer <span style="color:#e6db74">&#34;*scratch*&#34;</span>
    (setq termframe frame))
  )

(add-hook <span style="color:#e6db74">&#39;after-make-frame-functions</span> <span style="color:#e6db74">&#39;set-termframe</span>)

<span style="color:#75715e">;; This sets a buffer-local variable with the frame which started when this process started</span>
(defun my/term (program <span style="color:#66d9ef">&amp;optional</span> closeframe)
  (interactive)
  (with-current-buffer (term program)
    (<span style="color:#a6e22e">message</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;term &#34;</span> (str termframe)))
    (if closeframe
        <span style="color:#75715e">;; (defset-local termframe-local (with-current-buffer &#34;*scratch*&#34; termframe))</span>
        (defset-local termframe-local termframe))
    (if (<span style="color:#a6e22e">string-equal</span> program <span style="color:#e6db74">&#34;midnight-commander&#34;</span>)
        (mc-minor-mode)))
  <span style="color:#75715e">;; (add-hook &#39;after-make-frame-functions &#39;set-termframe)</span>
  )

<span style="color:#75715e">;; This sets the process sentinel to close the frame</span>
(defun oleh-term-exec-hook ()
  (<span style="color:#a6e22e">message</span> <span style="color:#e6db74">&#34;oleh-term-exec-hook()&#34;</span>)
  (let* ((buff (<span style="color:#a6e22e">current-buffer</span>))
         (proc (<span style="color:#a6e22e">get-buffer-process</span> buff)))
    (<span style="color:#a6e22e">message</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;setting &#34;</span> (str buff) <span style="color:#e6db74">&#34; &#34;</span> (str proc)))
    (<span style="color:#a6e22e">set-process-sentinel</span>
     proc
     <span style="color:#f92672">`</span>(lambda (process event)
        (if (<span style="color:#a6e22e">string-match</span> <span style="color:#e6db74">&#34;\\(finished\\|exited\\)&#34;</span> event)
            <span style="color:#75715e">;; (string= event &#34;finished\n&#34;)</span>
            (progn
              (<span style="color:#a6e22e">message</span> <span style="color:#e6db74">&#34;finished&#34;</span>)
              (if (variable-p <span style="color:#e6db74">&#39;termframe-local</span>)
                  (<span style="color:#a6e22e">delete-frame</span> termframe-local <span style="color:#66d9ef">t</span>))
              (with-current-buffer <span style="color:#f92672">,</span>buff (ignore-errors (kill-buffer-and-window)))))))

    (<span style="color:#a6e22e">message</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;setting &#34;</span> (str buff) <span style="color:#e6db74">&#34; &#34;</span> (str proc) <span style="color:#e6db74">&#34; &#34;</span> (str (<span style="color:#a6e22e">process-sentinel</span> (<span style="color:#a6e22e">get-buffer-process</span> (<span style="color:#a6e22e">current-buffer</span>))))))))

(add-hook <span style="color:#e6db74">&#39;term-exec-hook</span> <span style="color:#e6db74">&#39;oleh-term-exec-hook</span>)</code></pre></td></tr></table>
</div>
</div>
<h3 id="demonstration">Demonstration</h3>
<p><a title="asciinema recording" href="https://asciinema.org/a/otP5gMD1mkYvUw7WCpFm1V2Dh" target="_blank"><img alt="asciinema recording" src="https://asciinema.org/a/otP5gMD1mkYvUw7WCpFm1V2Dh.svg" /></a></p>
<h2 id="spacemacs-needed-me-to-remove-this-dot-it-ignored-the-sentinel-i-made-to-force-the-way-term-closes">Spacemacs needed me to remove this. It ignored the sentinel i made to force the way term-closes</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">vim +/<span style="color:#e6db74">&#34;;; Perhaps there is something in spacemacs force the ignore&#34;</span> <span style="color:#e6db74">&#34;</span>$EMACSD<span style="color:#e6db74">/config/my-term.el&#34;</span></code></pre></td></tr></table>
</div>
</div>
<p>Found it!</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(add-hook <span style="color:#e6db74">&#39;term-mode-hook</span> <span style="color:#e6db74">&#39;ansi-term-handle-close</span>)</code></pre></td></tr></table>
</div>
</div>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">vim +/<span style="color:#e6db74">&#34;(add-hook &#39;term-mode-hook &#39;ansi-term-handle-close)&#34;</span> <span style="color:#e6db74">&#34;</span>$MYGIT<span style="color:#e6db74">/spacemacs/layers/+tools/shell/packages.el&#34;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="solution">Solution</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(if (cl-search <span style="color:#e6db74">&#34;SPACEMACS&#34;</span> my-daemon-name)
    (remove-hook <span style="color:#e6db74">&#39;term-mode-hook</span> <span style="color:#e6db74">&#39;ansi-term-handle-close</span>))</code></pre></td></tr></table>
</div>
</div>
<h2 id="preventing-window-margins-from-interfering-with-term">Preventing window margins from interfering with term</h2>
<p>The problem makes term almost unusable.</p>
<p>Therefore, fixing it is important.</p>
<p>This appears to solve the problem</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(defun term-move-columns (delta)
  (setq term-current-column (<span style="color:#a6e22e">max</span> <span style="color:#ae81ff">0</span> (<span style="color:#a6e22e">+</span> (term-current-column) delta)))
  (let ((point-at-eol (<span style="color:#a6e22e">line-end-position</span>)))
    (<span style="color:#a6e22e">move-to-column</span> term-current-column <span style="color:#66d9ef">t</span>)
    <span style="color:#75715e">;; If move-to-column extends the current line it will use the face</span>
    <span style="color:#75715e">;; from the last character on the line, set the face for the chars</span>
    <span style="color:#75715e">;; to default.</span>
    (when (<span style="color:#a6e22e">&gt;</span> (<span style="color:#a6e22e">point</span>) point-at-eol)
      (<span style="color:#a6e22e">put-text-property</span> point-at-eol (<span style="color:#a6e22e">point</span>) <span style="color:#e6db74">&#39;font-lock-face</span> <span style="color:#e6db74">&#39;default</span>)))

  <span style="color:#75715e">;; This is almost a fix -- it might even be a fix</span>
  (<span style="color:#a6e22e">set-window-margins</span> (<span style="color:#a6e22e">selected-window</span>) <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>)
  (<span style="color:#a6e22e">set-window-hscroll</span> (<span style="color:#a6e22e">selected-window</span>) <span style="color:#ae81ff">0</span>)
  (<span style="color:#a6e22e">set-window-vscroll</span> (<span style="color:#a6e22e">selected-window</span>) <span style="color:#ae81ff">0</span>)

  <span style="color:#75715e">;; TODO Find a way to keep the column within</span>
  <span style="color:#75715e">;; (window-body-width)</span>

  <span style="color:#75715e">;; (window-total-width)</span>
  <span style="color:#75715e">;; (frame-width)</span>

  <span style="color:#75715e">;; (window-vscroll)</span>
  <span style="color:#75715e">;; (window-hscroll)</span>
  <span style="color:#75715e">;; (set-window-vscroll (selected-window) 0)</span>
  <span style="color:#75715e">;; (set-window-hscroll (selected-window) 0)</span>
  <span style="color:#75715e">;; (set-fringe-mode &#39;(0 . 0))</span>
  <span style="color:#75715e">;; (window-margins) ;this must be changed to (nil) from (1)</span>
  <span style="color:#75715e">;; Running git-gutter+-mode removed the margin/fringe/whatever it is</span>

  <span style="color:#75715e">;; This corrects it:</span>
  <span style="color:#75715e">;; But the terminal is still badly drawn</span>
  <span style="color:#75715e">;; (set-window-margins (selected-window) 0 0)</span>
  <span style="color:#75715e">;; (set-window-hscroll (selected-window) 0)</span>
  <span style="color:#75715e">;; (set-window-vscroll (selected-window) 0)</span>

  <span style="color:#75715e">;; Keep in mind that the columns may have not even</span>
  <span style="color:#75715e">;; If I call this every time then the screen will get messed up</span>
  <span style="color:#75715e">;; (call-interactively &#39;evil-scroll-left)</span>
  )</code></pre></td></tr></table>
</div>
</div>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>