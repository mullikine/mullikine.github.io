<!doctype html>
<html lang="en-us">
  <head>
    <title>Deconstructing the Cocomel search engine // Bodacious Blog</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.59.0-DEV" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://mullikine.github.io/css/main.min.065328ba02777ced5860a9c4cff59983d2ee1dca6a6b6eddea7aa8e3f4c858c7.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Deconstructing the Cocomel search engine"/>
<meta name="twitter:description" content="This is my attempt to understand Vaughan Kitchen&rsquo;s search engine.
 Source code https://github.com/vkitchen/cocomel Related articles Entropy, Cross-Entropy and KL-Divergence // Bodacious Blog An example information retrieval problem  Glossary 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71  red-black tree RBT [self-balancing binary search tree] Each node of the binary tree has an extra bit, and that bit is often interpreted as the color of the node."/>

    <meta property="og:title" content="Deconstructing the Cocomel search engine" />
<meta property="og:description" content="This is my attempt to understand Vaughan Kitchen&rsquo;s search engine.
 Source code https://github.com/vkitchen/cocomel Related articles Entropy, Cross-Entropy and KL-Divergence // Bodacious Blog An example information retrieval problem  Glossary 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71  red-black tree RBT [self-balancing binary search tree] Each node of the binary tree has an extra bit, and that bit is often interpreted as the color of the node." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mullikine.github.io/posts/deconstructing-cocomel/" />
<meta property="article:published_time" content="2019-11-06T00:00:00+13:00" />
<meta property="article:modified_time" content="2019-11-06T00:00:00+13:00" /><meta property="og:site_name" content="Bodacious Blog" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://mullikine.github.io"><img class="app-header-avatar" src="http://mullikine.github.io/fievel.png" alt="John Doe" /></a>
      <h1>Bodacious Blog</h1>
      
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://linkedin.com/in/shane-mulligan-811b942b/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>linkedin</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg></a>
        
          <a target="_blank" href="https://gitlab.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-gitlab">
  <title>gitlab</title>
  <path d="M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.49h8.1l2.44-7.51A.42.42 0 0 1 18.6 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.51L23 13.45a.84.84 0 0 1-.35.94z"></path>
</svg></a>
        
          <a target="_blank" href="https://twitter.com/mullikine"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
        <a href="https://mullikine.github.io/cv/">CV</a>
      </div>
<div class="highlights">
<a href="https://mullikine.github.io/posts/practical-macros-in-racket-and-how-to-work-with-them/">Practical macros in Racket</a>
<br />
<a href="https://mullikine.github.io/posts/github-search-with-bigquery/">Searching GitHub with BigQuery</a>

<br />
<a href="https://mullikine.github.io/posts/arbitrary-interpreters-for-babel/">Arbitrary interpreters for Babel</a>
<br />
<a href="https://mullikine.github.io/posts/review-of-the-illustrated-transformer/">The Illustrated Transformer</a>
<br />
<a href="https://mullikine.github.io/glossary.html">Glossary A-Z (70 topics)</a>
<br />
<a href="https://mullikine.github.io/codelingo-vs-linters/summary/">CodeLingo vs Linters</a>
<br />
<div class="taglist">

<a class="tag" href="https://mullikine.github.io/tags/gpt-2/">GPT-2</a>
<a class="tag" href="https://mullikine.github.io/tags/nlp/">NLP</a>
<a class="tag big" href="https://mullikine.github.io/tags/emacs/">emacs</a>
<a class="tag" href="https://mullikine.github.io/tags/elisp/">elisp</a>
<a class="tag" href="https://mullikine.github.io/tags/racket/">racket</a>
<a class="tag" href="https://mullikine.github.io/tags/haskell/">haskell</a>
<a class="tag" href="https://mullikine.github.io/tags/biosemiotics/">biosemiotics</a>
<a class="tag big" href="https://mullikine.github.io/tags/ir/">IR</a>
<a class="tag" href="https://mullikine.github.io/tags/games/">games</a>
<a class="tag" href="https://mullikine.github.io/tags/data/">data</a>
<a class="tag" href="https://mullikine.github.io/tags/info/">info theory</a>
<a class="tag" href="https://mullikine.github.io/tags/probability/">probability</a>
<a class="tag" href="https://mullikine.github.io/tags/problog/">problog</a>
<a class="tag big" href="https://mullikine.github.io/tags/bash/">bash</a>
<a class="tag" href="https://mullikine.github.io/tags/gcp/">GCP</a>
<a class="tag" href="https://mullikine.github.io/tags/github/">github</a>
<a class="tag" href="https://mullikine.github.io/tags/parsers/">parsers</a>
<a class="tag" href="https://mullikine.github.io/tags/rust/">rust</a>
<a class="tag" href="https://mullikine.github.io/tags/cpp/">c++</a>

<a class="tag" href="https://mullikine.github.io/tags/review/">review</a>
<a class="tag" href="https://mullikine.github.io/tags/kaggle/">kaggle</a>
<a class="tag" href="https://mullikine.github.io/tags/dl/">deep learning</a>
<a class="tag" href="https://mullikine.github.io/tags/dsls/">DSLs</a>
<a class="tag" href="https://mullikine.github.io/tags/df/">dwarf fortress</a>
<a class="tag" href="https://mullikine.github.io/tags/spacy/">spacy</a>
<a class="tag" href="https://mullikine.github.io/tags/latex/">latex</a>
<a class="tag" href="https://mullikine.github.io/tags/graphviz/">graphviz</a>
<a class="tag" href="https://mullikine.github.io/tags/python/">python</a>
<a class="tag" href="https://mullikine.github.io/tags/golang/">golang</a>
<a class="tag" href="https://mullikine.github.io/tags/codelingo/">codelingo</a>
<a class="tag" href="https://mullikine.github.io/tags/perl/">perl</a>
<a class="tag" href="https://mullikine.github.io/tags/math/">math</a>
<a class="tag big" href="https://mullikine.github.io/tags/vim/">vim</a>
<a class="tag" href="https://mullikine.github.io/tags/telco/">telco</a>
<a class="tag" href="https://mullikine.github.io/tags/automation/">automation</a>
<a class="tag" href="https://mullikine.github.io/tags/terminals/">terminals</a>
<a class="tag" href="https://mullikine.github.io/tags/transformer/">transformer</a>
<a class="tag big" href="https://mullikine.github.io/tags/codegen/">code-gen</a></div>
<a class="tag" href="https://mullikine.github.io/tags/optimisation/">optimisation</a></div>
</div>
<div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Deconstructing the Cocomel search engine</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Nov 6, 2019
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          12 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://mullikine.github.io/tags/ir/">ir</a><a class="tag" href="http://mullikine.github.io/tags/cpp/">cpp</a></div></div>
    </header>
    

<link rel="stylesheet" type="text/css" href="https://mullikine.github.io/css/magit.css"/>

<script src="https://mullikine.github.io/js/mathjax-config.js"></script>
 
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML"></script>


    <div class="post-content">
      

<p>This is my attempt to understand <a href="http://vaughan.kitchen/">Vaughan Kitchen&rsquo;s</a> search engine.</p>

<dl>
<dt>Source code</dt>
<dd><a href="https://github.com/vkitchen/cocomel">https://github.com/vkitchen/cocomel</a></dd>
<dt>Related articles</dt>
<dd><a href="https://mullikine.github.io/posts/entropy-cross-entropy-and-kl-divergence/">Entropy, Cross-Entropy and KL-Divergence // Bodacious Blog</a> <br />
<a href="https://nlp.stanford.edu/IR-book/html/htmledition/an-example-information-retrieval-problem-1.html">An example information retrieval problem</a></dd>
</dl>

<h2 id="glossary">Glossary</h2>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">red-black tree
RBT
    [self-balancing binary search tree]

    Each node of the binary tree has an extra
    bit, and that bit is often interpreted as
    the color of the node.

    These color bits are used to ensure the
    tree remains approximately balanced during
    insertions and deletions.

binary search tree
BST
    Node-based binary tree data structure
    which has the following properties:

    - The left subtree of a node contains only
      nodes with keys lesser than the node’s
      key.

    - The right subtree of a node contains
      only nodes with keys greater than the
      node’s key.

    - The left and right subtree each must
      also be a binary search tree.

slurp
    Read into memory.

universal code
universal code for integers
    [#data compression]
    [prefix code]

    Maps the positive integers onto binary
    codewords, with the additional property
    that whatever the true probability
    distribution on integers, as long as the
    distribution is monotonic (i.e., p(i)
    ≥ p(i + 1) for all positive i) , the
    expected lengths of the codewords are
    within a constant factor of the expected
    lengths that the optimal code for that
    probability distribution would have
    assigned.

    Asymptotically optimal if the ratio
    between actual and optimal expected
    lengths is bounded by a function of the
    information entropy of the code that, in
    addition to being bounded, approaches 1 as
    entropy approaches infinity.

variable-length quantity
VLQ
    [universal code]

    Uses an arbitrary number of binary octets
    (eight-bit bytes) to represent an
    arbitrarily large integer.

    A VLQ is essentially a base-128
    representation of an unsigned integer with
    the addition of the eighth bit to mark
    continuation of bytes.

continuation bit
continuing bit
    See &#34;variable-length quantity&#34;.</code></pre></td></tr></table>
</div>
</div>

<h2 id="class-diagrams-in-uml">Class diagrams in UML</h2>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">find -L -O3 $CWD <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -not -path <span style="color:#e6db74">&#39;*/build/*&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -and <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#ae81ff">\(</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -name <span style="color:#e6db74">&#39;*.py&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o -name <span style="color:#e6db74">&#39;*.php&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o -name <span style="color:#e6db74">&#39;*.java&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o -iname <span style="color:#e6db74">&#39;*.[CH]&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o -name <span style="color:#e6db74">&#39;*.cpp&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o -name <span style="color:#e6db74">&#39;*.hpp&#39;</span>  <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o -name <span style="color:#e6db74">&#39;*.cc&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o -name <span style="color:#e6db74">&#39;*.hh&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o -name <span style="color:#e6db74">&#39;*.hs&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#ae81ff">\)</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    &gt; <span style="color:#e6db74">&#34;</span>$destdir<span style="color:#e6db74">/cscope.files&#34;</span>

$HOME/scripts/ctags --fields<span style="color:#f92672">=</span>+latinK+i -R -L ./cscope.files
$MYGIT/Guad/tags2uml/tags2uml --members<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --methods<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --infile tags | tee uml.dot | dot-png uml</code></pre></td></tr></table>
</div>
</div>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-org" data-lang="org"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-org" data-lang="org"><span style="color:#75715e">#+BEGIN_SRC </span><span style="color:#75715e">graphviz-dot</span><span style="color:#75715e"> -n :filter dot-digraph cocomel-uml :async :results raw drawer
</span><span style="color:#75715e"></span>  n6 [label=&#34;{str|- store\l|+ c_dup()\l+ c_str()\l+ length()\l+ resize()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n7 [label=&#34;{tokenizer|- document\l- index\l- length\l|+ init()\l  next()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n8 [label=&#34;{tokenizer_zlib|- document\l- document_max\l- fd\l- header_buffer\l- index\l- length\l|+ cleanup()\l+ init()\l  next()\l  next_file()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n1 [label=&#34;{bst|- key\l- left\l- right\l- store\l|+ insert()\l+ write()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n2 [label=&#34;{dynamic_array|+ capacity\l+ length\l+ store\l|+ append()\l+ back()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n3 [label=&#34;{hash_table|- capacity\l- lengths\l- store\l|+ find()\l- hash()\l+ insert()\l+ read()\l+ write()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n4 [label=&#34;{linked_array|+ chunk_length\l- current\l- index\l+ last\l+ length\l+ next\l+ store\l|+ append()\l+ back()\l+ begin()\l+ end()\l+ iterator()\l}&#34; style=filled color=&#34;#ff9999&#34; fontcolor=&#34;#999999&#34; fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n5 [label=&#34;{posting|- counts\l- id\l- id_capacity\l- id_length\l- id_store\l|  append()\l  decompress()\l  write()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
<span style="color:#75715e">#+END_SRC</span></code></pre></td></tr></table>
</div>
</div>

<figure>
    <img src="https://mullikine.github.io/ox-hugo/cocomel-uml.png"/> 
</figure>


<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-org" data-lang="org"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-org" data-lang="org"><span style="color:#75715e">#+BEGIN_SRC </span><span style="color:#75715e">graphviz-dot</span><span style="color:#75715e"> -n :filter dot-digraph-ascii :async :results verbatim code
</span><span style="color:#75715e"></span>  n6 [label=&#34;{str|- store\l|+ c_dup()\l+ c_str()\l+ length()\l+ resize()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n7 [label=&#34;{tokenizer|- document\l- index\l- length\l|+ init()\l  next()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n8 [label=&#34;{tokenizer_zlib|- document\l- document_max\l- fd\l- header_buffer\l- index\l- length\l|+ cleanup()\l+ init()\l  next()\l  next_file()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n1 [label=&#34;{bst|- key\l- left\l- right\l- store\l|+ insert()\l+ write()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n2 [label=&#34;{dynamic_array|+ capacity\l+ length\l+ store\l|+ append()\l+ back()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n3 [label=&#34;{hash_table|- capacity\l- lengths\l- store\l|+ find()\l- hash()\l+ insert()\l+ read()\l+ write()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n4 [label=&#34;{linked_array|+ chunk_length\l- current\l- index\l+ last\l+ length\l+ next\l+ store\l|+ append()\l+ back()\l+ begin()\l+ end()\l+ iterator()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
  n5 [label=&#34;{posting|- counts\l- id\l- id_capacity\l- id_length\l- id_store\l|  append()\l  decompress()\l  write()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
<span style="color:#75715e">#+END_SRC</span></code></pre></td></tr></table>
</div>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">+----------------+-----------------+--------------+
|                |      - key      |              |
|      bst       |  - left         |  + insert()  |
|                |  - right        |  + write()   |
|                |  - store        |              |
+----------------+-----------------+--------------+
+----------------+-----------------+--------------+
|                |    + capacity   |  + append()  |
| dynamic_array  |  + length       |  + back()    |
|                |  + store        |              |
+----------------+-----------------+--------------+
+----------------+-----------------+--------------+
|                |                 |   + find()   |
|                |    - capacity   |  - hash()    |
|   hash_table   |  - lengths      |  + insert()  |
|                |  - store        |  + read()    |
|                |                 |  + write()   |
+----------------+-----------------+--------------+
+----------------+-----------------+--------------+
|                |  + chunk_length |              |
|                |  - current      |  + append()  |
|                |  - index        |  + back()    |
|  linked_array  |  + last         |  + begin()   |
|                |  + length       |  + end()     |
|                |  + next         |  + iterator()|
|                |  + store        |              |
+----------------+-----------------+--------------+
+----------------+-----------------+--------------+
|                |     - counts    |              |
|                |  - id           |   append()   |
|    posting     |  - id_capacity  |  decompress()|
|                |  - id_length    |  write()     |
|                |  - id_store     |              |
+----------------+-----------------+--------------+
+----------------+-----------------+--------------+
|                |                 |   + c_dup()  |
|      str       |     - store     |  + c_str()   |
|                |                 |  + length()  |
|                |                 |  + resize()  |
+----------------+-----------------+--------------+
+----------------+-----------------+--------------+
|                |    - document   |   + init()   |
|   tokenizer    |  - index        |  next()      |
|                |  - length       |              |
+----------------+-----------------+--------------+
+----------------+-----------------+--------------+
|                |    - document   |              |
|                |  - document_max |  + cleanup() |
| tokenizer_zlib |  - fd           |  + init()    |
|                |  - header_buffer|  next()      |
|                |  - index        |  next_file() |
|                |  - length       |              |
+----------------+-----------------+--------------+</code></pre></div>
<h3 id="extra-classes">Extra classes</h3>

<p>The class-diagram generator didn&rsquo;t pick up on
this. Actually, it incorrectly bundled all the
methods and attributes into the parent class.</p>

<p>The <code>iterator</code> class is a public member of <code>class linked_array</code>. It is, however, only used by and closely coupled to <code>linked_array</code>.</p>

<p>I graphed this manually.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphviz-dot" data-lang="graphviz-dot"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphviz-dot" data-lang="graphviz-dot">n1 [label=&#34;{linked_array|+ chunk_length\l+ last\l+ length\l+ next\l+ store\l|+ append()\l+ back()\l+ begin()\l+ end()\l+ iterator()\l}&#34; style=filled color=&#34;#ff9999&#34; fontcolor=&#34;#999999&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];
n2 [label=&#34;{iterator|- current\l- index\l|+ !=()\l+ *() \l+ ++()\l}&#34; style=filled color=&#34;#ff9999&#34; fontcolor=&#34;#999999&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];</code></pre></td></tr></table>
</div>
</div>

<figure>
    <img src="https://mullikine.github.io/ox-hugo/linked-array.png"/> 
</figure>


<h4 id="the-true-linked-array">The true <code>linked_array</code></h4>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphviz-dot" data-lang="graphviz-dot"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphviz-dot" data-lang="graphviz-dot">n1 [label=&#34;{linked_array|+ chunk_length\l+ last\l+ length\l+ next\l+ store\l|+ append()\l+ back()\l+ begin()\l+ end()\l+ iterator()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];</code></pre></td></tr></table>
</div>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphviz-dot" data-lang="graphviz-dot">+--------------+----------------+--------------+
|              | + chunk_length |  + append()  |
|              |  + last        |  + back()    |
| linked_array |  + length      |  + begin()   |
|              |  + next        |  + end()     |
|              |  + store       |  + iterator()|
+--------------+----------------+--------------+</code></pre></div>
<h4 id="linked-array-iterator"><code>linked_array::iterator</code></h4>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphviz-dot" data-lang="graphviz-dot"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphviz-dot" data-lang="graphviz-dot">n2 [label=&#34;{iterator|- current\l- index\l|+ !=()\l+ *() \l+ ++()\l}&#34; style=filled fillcolor=&#34;#ffffff&#34; shape=&#34;record&#34;];</code></pre></td></tr></table>
</div>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphviz-dot" data-lang="graphviz-dot">+----------+-----------+--------+
|          | - current | + !=() |
| iterator |  - index  |  + *() |
|          |           |  + ++()|
+----------+-----------+--------+</code></pre></div>
<h2 id="source-file-overview">Source file overview</h2>

<table>
<thead>
<tr>
<th>header / source</th>
<th>purpose</th>
<th>capacity</th>
<th>used by</th>
<th>instances</th>
</tr>
</thead>

<tbody>
<tr>
<td>bst.h</td>
<td>provide binary search tree to hash table</td>
<td><strong>∞</strong></td>
<td>hash_table.h</td>
<td>one per hash table</td>
</tr>

<tr>
<td>hash_table.h</td>
<td>provide hash table</td>
<td><strong>65536</strong> <br/><br/> <em>1 &lt;&lt; 16 == 65536 = 0x10000</em></td>
<td></td>
<td></td>
</tr>

<tr>
<td>dynamic_array.h</td>
<td>provide array</td>
<td><strong>∞</strong> <br/><br/> <em>256 items initially, but doubles when reaching capacity</em></td>
<td>search_cli.cpp<br/> posting.cpp<br/> search.cpp<br/> search_cgi.cpp<br/> index.cpp</td>
<td>Once when searching from <code>search_cli.cpp</code>, <code>docNos</code> is created. This comes from searching via <code>search.cpp</code>. <br/><br/> When a search is run via <code>search.cpp</code> a postings list is decompressed for each search term; that&rsquo;s one <code>dynamic_array</code> per word. These postings go into the <code>intersect_postings()</code> function and a single <code>dynamic_array</code> is returned. This is what is passed to <code>search_cli.cpp</code>.</td>
</tr>
</tbody>
</table>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">postings list
    For each term there is a list that records
    which documents the term occurs in.

    It may also contain the positions in the
    document.

posting
    Each item in a postings list is called a posting.

inverted index
inverted file
    A dictionary of terms (sometimes also
    referred to as a vocabulary or lexicon.

    For each term there is a postings list.</code></pre></td></tr></table>
</div>
</div>

<table>
<thead>
<tr>
<th>header / source</th>
<th>purpose</th>
<th>capacity</th>
<th>used by</th>
<th>instances</th>
</tr>
</thead>

<tbody>
<tr>
<td>str.h</td>
<td>provide strings + str helper funcs</td>
<td><strong>∞</strong></td>
<td>search.cpp<br/> index.cpp<br/> bst.h<br/> tokenizer.h</td>
<td></td>
</tr>

<tr>
<td>file.{h,cpp}</td>
<td>slurping files</td>
<td><strong>∞</strong></td>
<td>search_cli.cpp<br/> search_cgi.cpp<br/> index.cpp</td>
<td>When searching, once to load index. <br/><br/> When indexing, once for each non gzipped file indexed.</td>
</tr>

<tr>
<td><del>linked_array.h</del></td>
<td><del>provide linked_array and iterator</del></td>
<td></td>
<td></td>
<td><span class="underline"><strong><code>Never used</code></strong></span></td>
</tr>

<tr>
<td>memory.{h,cpp}</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>posting.{h,cpp}</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>search.{h,cpp}</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>tar.h</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>tokenizer.{h,cpp}</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>tokenizer_zlib.{h,cpp}</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>vbyte.{h,cpp}</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>index.cpp</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>search_cgi.cpp</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>search_cli.cpp</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

<dl>
<dt>The variable &lsquo;<code>docNos</code>&lsquo;</dt>
<dd>An array of <code>int</code> pairs (<code>int</code>, <code>int</code>). Created upon searching.</dd>
</dl>

<h2 id="optimisations">Optimisations</h2>

<h3 id="bst-instead-of-rbt">BST instead of RBT</h3>

<p>Instead of a RBT, use a BST for the hash table.</p>

<p>RBT is slower because it&rsquo;s not ordered.</p>

<p>BST and hash table needs balancing.</p>

<p>Vaughan used gprof to profile the performance of the BST.</p>

<p>When you rebalance the tree you shuffle pointers around.</p>

<h3 id="memory-compression">memory compression</h3>

<p>Store in smaller amounts of memory means faster memory access.</p>

<h2 id="headers">Headers</h2>

<h3 id="bst-dot-h"><code>bst.h</code></h3>

<h4 id="includes-str-dot-h-and-memory-dot-h">includes <code>str.h</code>, and <code>memory.h</code></h4>

<h4 id="provides-bst">provides <code>bst</code></h4>

<ul>
<li><span class="underline"><strong>Attributes</strong></span>

<ul>
<li><strong>key:</strong> This is a number to be compared.</li>
<li><strong>left:</strong> The left subtree of a node contains only nodes with keys lesser than the node’s key.</li>
<li><strong>right:</strong> ditto</li>
</ul></li>
<li><span class="underline"><strong>Methods</strong></span>

<ul>
<li>bst (constructor)</li>
<li>insert</li>
<li>write</li>
</ul></li>
</ul>

<h3 id="dynamic-array-dot-h"><code>dynamic_array.h</code></h3>

<h4 id="includes-stdint-dot-h-stdlib-dot-h-and-memory-dot-h">includes <code>stdint.h</code>, <code>stdlib.h</code> and <code>memory.h</code></h4>

<h4 id="provides-dynamic-array">provides <code>dynamic_array</code></h4>

<ul>
<li><span class="underline"><strong>Attributes</strong></span>

<ul>
<li>capacity</li>
<li>length</li>
</ul></li>
<li><span class="underline"><strong>Methods</strong></span>

<ul>
<li>dynamic_array (constructor)</li>
<li>append</li>
<li>back</li>
</ul></li>
</ul>

<h3 id="hash-table-dot-h"><code>hash_table.h</code></h3>

<h4 id="includes-bst-dot-h">includes <code>bst.h</code></h4>

<h4 id="provides-hash-table">provides <code>hash_table</code></h4>

<ul>
<li><p><span class="underline"><strong>Attributes</strong></span></p>

<ul>
<li>store</li>
<li>lengths</li>
</ul></li>

<li><p><span class="underline"><strong>Methods</strong></span></p>

<ul>
<li>hash_table (constructor)</li>
<li>hash</li>
<li>insert</li>
<li>find</li>
<li>write</li>
<li>read</li>
</ul></li>
</ul>

<h3 id="linked-array-dot-h--you-can-ignore-this"><code>linked_array.h</code> (You can ignore this)</h3>

<p>It is never actually used.</p>

<h4 id="linked-array-iterator-class"><code>linked_array::iterator</code> class</h4>

<p><span class="underline"><strong>Overloaded dereference operator <code>*</code></strong></span></p>

<p>The purpose of dereference operator is to
dereference a pointer and returns the object
reference. Hence it must return the reference.
That is why it is <code>T&amp;</code>.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">T <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span> <span style="color:#f92672">*</span>()
{
  <span style="color:#66d9ef">return</span> current<span style="color:#f92672">-&gt;</span>store[index];
}
</code></pre></td></tr></table>
</div>
</div>

<p>The <code>&amp;</code> means that the return type is a
reference; you should read this as function
operator <code>*</code> that returns a type of <code>T &amp;</code>.</p>

<dl>
<dt>As an aside</dt>
<dd><p>The purpose of referring operator (<code>-&gt;</code>) is to
return a pointer and hence <code>T*</code> is returned.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">    T<span style="color:#f92672">*</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">-&gt;</span> ()
    {
        <span style="color:#66d9ef">return</span> pData;
    }
    
</code></pre></td></tr></table>
</div>
</div></dd>
<dt>address operator</dt>
<dd><p>The ampersand symbol &amp; is used in
C++ as a reference declarator in addition to being the address operator.</p></dd>
</dl>

<table>
<thead>
<tr>
<th>op</th>
<th>name</th>
<th></th>
</tr>
</thead>

<tbody>
<tr>
<td><code>(type)</code></td>
<td>cast</td>
<td>2nd highest precedence</td>
</tr>

<tr>
<td><code>*</code></td>
<td>dereference</td>
<td>2nd highest precedence</td>
</tr>

<tr>
<td><code>&amp;</code></td>
<td>address</td>
<td>2nd highest precedence</td>
</tr>

<tr>
<td><code>-&gt;</code></td>
<td>referring</td>
<td>highest precedence</td>
</tr>

<tr>
<td><code>[]</code></td>
<td>subscript</td>
<td>highest precedence</td>
</tr>
</tbody>
</table>

<p><span class="underline"><strong>Increment operator <code>++</code></strong></span></p>

<p>When I saw this my first thought was
concatenate. I&rsquo;ve been reading too much
haskell.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">iterator <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span> <span style="color:#f92672">++</span>()
{
  index<span style="color:#f92672">++</span>;
  <span style="color:#66d9ef">if</span> (index <span style="color:#f92672">==</span> current<span style="color:#f92672">-&gt;</span>chunk_length)
    {
      index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
      current <span style="color:#f92672">=</span> current<span style="color:#f92672">-&gt;</span>next;
    }
  <span style="color:#66d9ef">return</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>;
}
</code></pre></td></tr></table>
</div>
</div>

<p>When you call <code>iterator++</code> it returns a
pointer to <code>iterator</code>, which on its own seems
pointless, but it also increments the internal
value <code>index</code> which keeps track of which item the
iterator thinks is current.</p>

<p>The internal value (<code>index</code>) is also used by
the dereference operator of <code>iterator</code> to
specify which element of the array <code>store</code>
(contained in <code>linked_array</code>, the parent
class) to return a reference to.</p>

<h2 id="application-logic">Application logic</h2>

<h4 id="search-cli-dot-cpp"><code>search_cli.cpp</code></h4>

<p>Read in a query string from the user.</p>

<p>Read in the index (<code>index.dat</code>) naïvely into a <code>char *</code>. Think of it as an array of bytes. You can then do <code>index[2 * sizeof(uint32_t)]</code> and that means the pointer to the 3rd <code>uint32_t</code>. We refer to the <code>char *</code> as &ldquo;<code>index</code>&rdquo; from now on since that&rsquo;s its variable name.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// Read in the index (=index.dat=)
</span><span style="color:#75715e"></span>file_slurp(<span style="color:#e6db74">&#34;index.dat&#34;</span>, <span style="color:#f92672">&amp;</span>index);
</code></pre></td></tr></table>
</div>
</div>

<p><code>docNos</code> is an array of <code>int</code> pairs (<code>int</code>, <code>int</code>).</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// docNos
</span><span style="color:#75715e"></span>dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>uint32_t, uint32_t<span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">*</span>docNos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>uint32_t, uint32_t<span style="color:#f92672">&gt;&gt;</span>();
</code></pre></td></tr></table>
</div>
</div>

<p>Reinterpret the <code>char *</code> index as an array of <code>uint32</code>.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// Reinterpret
</span><span style="color:#75715e"></span>(uint32_t <span style="color:#f92672">*</span>)index
</code></pre></td></tr></table>
</div>
</div>

<p>The number of pairs contained in <code>docNos</code> is
determined by reading the second <code>uint32</code> from
<code>index</code>.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// The number of pairs contained in =docNos=
</span><span style="color:#75715e"></span>docNos<span style="color:#f92672">-&gt;</span>length <span style="color:#f92672">=</span> ((uint32_t <span style="color:#f92672">*</span>)index)[<span style="color:#ae81ff">1</span>];
</code></pre></td></tr></table>
</div>
</div>

<p>This is because <code>index</code> is probably an array
of arrays. The first <code>uint32</code> is probably the
size of the parent array. I will find out later.</p>

<dl>
<dt>I think I found it</dt>
<dd><p>It might be the position of the dictionary</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">    vim +/<span style="color:#e6db74">&#34;size_t dict_offset&#34;</span> <span style="color:#e6db74">&#34;</span>$MYGIT<span style="color:#e6db74">/vkitchen/cocomel/search.cpp&#34;</span>
    </code></pre></td></tr></table>
</div>
</div>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">    <span style="color:#75715e">// Decode index
</span><span style="color:#75715e"></span>    dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>uint32_t, uint32_t<span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">*</span>docNos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>uint32_t, uint32_t<span style="color:#f92672">&gt;&gt;</span>();
    docNos<span style="color:#f92672">-&gt;</span>length <span style="color:#f92672">=</span> ((uint32_t <span style="color:#f92672">*</span>)index)[<span style="color:#ae81ff">1</span>];
    docNos<span style="color:#f92672">-&gt;</span>store <span style="color:#f92672">=</span> (std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>uint32_t, uint32_t<span style="color:#f92672">&gt;</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>index[<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(uint32_t)];

    size_t dict_offset <span style="color:#f92672">=</span> ((uint32_t <span style="color:#f92672">*</span>)index)[<span style="color:#ae81ff">0</span>];
    hash_table<span style="color:#f92672">&lt;</span>posting, uint32_t<span style="color:#f92672">&gt;</span> <span style="color:#f92672">*</span>dictionary <span style="color:#f92672">=</span> hash_table<span style="color:#f92672">&lt;</span>posting, uint32_t<span style="color:#f92672">&gt;::</span>read(<span style="color:#f92672">&amp;</span>index[dict_offset]);
    
</code></pre></td></tr></table>
</div>
</div></dd>
</dl>

<p>Load the actual pairs of <code>uint32</code> from the
index into <code>docNos</code>. Get the address of the
3rd int of index. This is the pointer to the
first pair of ints in the array.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// Load the actual pairs of =uint32=
</span><span style="color:#75715e"></span>docNos<span style="color:#f92672">-&gt;</span>store <span style="color:#f92672">=</span> (std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>uint32_t, uint32_t<span style="color:#f92672">&gt;</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>index[<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(uint32_t)];
</code></pre></td></tr></table>
</div>
</div>

<h2 id="instances">Instances</h2>

<h3 id="dynamic-array-dot-h-1"><code>dynamic_array.h</code></h3>

<p>These are the instances of <code>dynamic_array</code> within <code>cocomel</code>.</p>

<h4 id="search-cli-dot-cpp-1"><code>search_cli.cpp</code></h4>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>uint32_t, uint32_t<span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">*</span>docNos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>uint32_t, uint32_t<span style="color:#f92672">&gt;&gt;</span>();
dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>size_t, <span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">*</span>result_list <span style="color:#f92672">=</span> search(index, line);
</code></pre></td></tr></table>
</div>
</div>

<h4 id="posting-dot-cpp"><code>posting.cpp</code></h4>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>size_t, <span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">*</span>out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>size_t, <span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;&gt;</span>;
</code></pre></td></tr></table>
</div>
</div>

<h4 id="search-dot-cpp"><code>search.cpp</code></h4>

<p>When you decompress a posting.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">dynamic_array<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span>size_t, <span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">*</span>post <span style="color:#f92672">=</span> ((posting <span style="color:#f92672">*</span>)terms<span style="color:#f92672">-&gt;</span>store[i])<span style="color:#f92672">-&gt;</span>decompress();
</code></pre></td></tr></table>
</div>
</div>

<h2 id="building-the-index">building the index</h2>

<h2 id="functions">functions</h2>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">size_t <span style="color:#a6e22e">file_slurp</span>(<span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>filename, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>into) {
  FILE <span style="color:#f92672">*</span>fh;
  <span style="color:#66d9ef">struct</span> stat details;
  size_t file_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

  <span style="color:#66d9ef">if</span> ((fh <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74">&#34;rb&#34;</span>)) <span style="color:#f92672">!=</span> NULL) {
    <span style="color:#66d9ef">if</span> (fstat(fileno(fh), <span style="color:#f92672">&amp;</span>details) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
      <span style="color:#66d9ef">if</span> ((file_length <span style="color:#f92672">=</span> details.st_size) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#f92672">*</span>into <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)malloc(file_length <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
        (<span style="color:#f92672">*</span>into)[file_length] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
        <span style="color:#66d9ef">if</span> (fread(<span style="color:#f92672">*</span>into, details.st_size, <span style="color:#ae81ff">1</span>, fh) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>) {
          free(<span style="color:#f92672">*</span>into);
          file_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        }
      }
    fclose(fh);
  }

  <span style="color:#66d9ef">return</span> file_length;
}
</code></pre></td></tr></table>
</div>
</div>

<p>The function <code>fileno()</code> examines the
argument stream and returns its integer
descriptor.</p>

<h2 id="appendix">Appendix</h2>

<h3 id="gprof-notes-taken-from-the-man-page"><code>Gprof</code> &ndash; Notes taken from the man page</h3>

<p>A profiler that calculates the amount of time spent in
each routine.</p>

<p>Next, these times are propagated along the
edges of the call graph.</p>

<p>Cycles are discovered, and calls into a cycle
are made to share the time of the cycle.</p>

<h4 id="types-of-output">Types of output</h4>

<p>Several forms of output are available from the
analysis.</p>

<dl>
<dt><span class="underline"><strong>flat profile</strong></span></dt>
<dd><p>Shows how much time your
program spent in each function, and how many
times that function was called.</p>

<p>If you simply want to know which functions
burn most of the cycles, it is stated
concisely here.</p></dd>
<dt><span class="underline"><strong>call graph</strong></span></dt>
<dd><p>Shows, for each function, which
functions called it, which other functions it
called, and how many times.</p>

<p>There is also an estimate of how much time was
spent in the subroutines of each function.</p>

<p>This can suggest places where you might try to
eliminate function calls that use a lot of
time.</p></dd>
<dt><span class="underline"><strong>annotated source listing</strong></span></dt>
<dd><p>A copy of the
program&rsquo;s source code, labeled with the number
of times each line of the program was
executed.</p></dd>
</dl>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>